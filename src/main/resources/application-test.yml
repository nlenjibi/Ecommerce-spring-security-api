spring:
  application:
    name: e-store

  datasource:
    url: ${DATABASE_URL}
    username: ${USER_NAME}
    password: ${PASSWORD}
    driver-class-name: ${DATABASE_DRIVER}
    hikari:
      auto-commit: false

  jpa:
    hibernate:
      ddl-auto: update  # Drop and recreate tables on startup
    show-sql: true
    open-in-view: false
    properties:
      hibernate:
        dialect: org.hibernate.dialect.PostgreSQLDialect
        format_sql: true
        use_sql_comments: true

  # Flyway Configuration
  flyway:
    enabled: true
    locations: classpath:db/migration
    baseline-on-migrate: true
    baseline-version: 0
    validate-on-migrate: true
    out-of-order: false
    clean-disabled: true  # Prevent accidental data loss
    placeholder-replacement: true
    placeholders:
      schema: public

  # Cache configuration for testing (minimal caching)
  cache:
    type: caffeine
    caffeine:
      spec: maximumSize=100,expireAfterWrite=1m,recordStats
    cache-names: products,categories,carts,users,reviews,orders,users-page,users-search,users-role,users-active,users-predicate,admin-dashboard

  graphql:
    graphiql:
      enabled: true
      path: /graphiql
    path: /graphql
    schema:
      locations: classpath:graphql/
      file-extensions: .graphqls
      printer:
        enabled: true
    cors:
      allowed-origins:
        - "http://localhost:3000"
        - "https://localhost:3000"
      allowed-methods: [ "GET", "POST", "PUT", "DELETE", "OPTIONS" ]
      allowed-headers: [ "*" ]
      allow-credentials: true

  # âœ… Fixed indentation
  thymeleaf:
    check-template-location: false

# Custom cache properties for testing
cache:
  default-ttl: 1   # minute - very short for testing
  product-ttl: 1   # minute
  category-ttl: 2  # minutes
  user-ttl: 1      # minute
  max-size: 100     # entries - small for testing

logging:
  level:
    root: INFO
    com.smart_ecomernce_api: DEBUG
    org.hibernate.tool.schema: ERROR
    org.springframework.graphql: DEBUG
    org.springframework.web: DEBUG
    org.springframework.cache: DEBUG
    com.github.benmanes.caffeine: DEBUG
  pattern:
    console: "%d{HH:mm:ss.SSS} [%thread] %-5level %logger{36} - %msg%n"

server:
  port: 9190
  servlet:
    context-path: /api
  forward-headers-strategy: framework

#springdoc:
#  api-docs:
#    enabled: true
#    path: /v3/api-docs
#    version: OPENAPI_3_0
#  swagger-ui:
#    enabled: true
#    path: /swagger-ui.html
#    try-it-out-enabled: true
#    operations-sorter: method
#    tags-sorter: alpha
#
springdoc:
  api-docs:
    path: /v3/api-docs
    enabled: true
  swagger-ui:
    path: /swagger-ui.html
    enabled: true
    operations-sorter: method
    tags-sorter: alpha
    display-request-duration: true
    filter: true
  paths-to-match:
    - /api/**
  packages-to-scan:
    - com.smart_ecomernce_api.smart_ecomernce_api.controller
  default-consumes-media-type: application/json
  default-produces-media-type: application/json

cart:
  auto-cleanup-enabled: false
# JWT Configuration
jwt:
  secret: ${JWT_SECRET:your-256-bit-secret-key-for-jwt-signing-must-be-at-least-32-chars}
  access-token:
    expiration: 3600000
  refresh-token:
    expiration: 604800000
  blacklist:
    max-size: 10000
    expire-after-write-hours: 24

# OAuth2 Configuration
spring.security.oauth2.client.registration.google:
  client-id: ${GOOGLE_CLIENT_ID:your-google-client-id}
  client-secret: ${GOOGLE_CLIENT_SECRET:your-google-client-secret}
  scope: profile, email
  redirect-uri: "{baseUrl}/login/oauth2/code/{registrationId}"
  client-name: Google

spring.security.oauth2.client.registration.github:
  client-id: ${GITHUB_CLIENT_ID:your-github-client-id}
  client-secret: ${GITHUB_CLIENT_SECRET:your-github-client-secret}
  scope: read:user, user:email
  redirect-uri: "{baseUrl}/login/oauth2/code/{registrationId}"
  client-name: GitHub

spring.security.oauth2.client.registration.facebook:
  client-id: ${FACEBOOK_CLIENT_ID:your-facebook-client-id}
  client-secret: ${FACEBOOK_CLIENT_SECRET:your-facebook-client-secret}
  scope: email, public_profile
  redirect-uri: "{baseUrl}/login/oauth2/code/{registrationId}"
  client-name: Facebook

spring.security.oauth2.client.provider.google:
  authorization-uri: https://accounts.google.com/o/oauth2/v2/auth
  token-uri: https://oauth2.googleapis.com/token
  user-info-uri: https://www.googleapis.com/oauth2/v3/userinfo
  user-name-attribute: sub

spring.security.oauth2.client.provider.github:
  authorization-uri: https://github.com/login/oauth/authorize
  token-uri: https://github.com/login/oauth/access_token
  user-info-uri: https://api.github.com/user
  user-name-attribute: id

spring.security.oauth2.client.provider.facebook:
  authorization-uri: https://www.facebook.com/v18.0/dialog/oauth
  token-uri: https://graph.facebook.com/v18.0/oauth/access_token
  user-info-uri: https://graph.facebook.com/v18.0/me?fields=id,name,email,picture
  user-name-attribute: id
# Management endpoints for cache monitoring in tests
management:
  endpoints:
    web:
      exposure:
        include: health,info,metrics,caches,cache
  endpoint:
    health:
      show-details: always
    caches:
      enabled: true
  metrics:
    export:
      simple:
        enabled: true
